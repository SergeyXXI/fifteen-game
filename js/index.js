!function(){const t=document.getElementById("field"),n=document.getElementById("mix-btn"),e=[...t.querySelectorAll(".fifteen__item")],o=e.map((t=>+t.dataset.value)),r=16,c={x:-1,y:-1};let i=!1;if(e.length!==r)throw new Error("Должно быть 16 квадратов!");e[15].style.display="none";const s=function(){const t=[[],[],[],[]];return function(t,n){for(let e=0;e<r;e++)t[~~(e/4)][e%4]=n[e]}(t,o),t}();function a(t,n,o){e[o].style.transform="translate3d(".concat(100*t,"%, ").concat(100*n,"%, 0)")}function f(){for(let t=0;t<100;t++){const{x:t,y:n}=d(r),e=u(t,n),{x:o,y:c}=e[Math.floor(Math.random()*e.length)];y({x:o,y:c,xTo:t,yTo:n},!0)}s.forEach(((t,n)=>{t.forEach(((t,e)=>{a(e,n,t-1)}))})),i&&(i=!1,n.innerText="Перемешать",t.classList.remove("fifteen_victory"))}function u(t,n){const e=[];return l(t+1,t,n,n)&&c.x!==t+1&&e.push({x:t+1,y:n}),l(t-1,t,n,n)&&c.x!==t-1&&e.push({x:t-1,y:n}),l(t,t,n+1,n)&&c.y!==n+1&&e.push({x:t,y:n+1}),l(t,t,n-1,n)&&c.y!==n-1&&e.push({x:t,y:n-1}),c.x=t,c.y=n,e}function l(t,n,e,o){const r=Math.abs(t-n),c=Math.abs(e-o);return(1===r||1===c)&&(t===n||e===o)&&t>=0&&t<=3&&e>=0&&e<=3}function y(n){let{x:e,y:o,xTo:r,yTo:c}=n,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=s[o][e],l=s[c][r],y=s[c][r];s[c][r]=s[o][e],s[o][e]=y,f||(a(e,o,l-1),a(r,c,u-1),x()&&(i=!0,t.classList.add("fifteen_victory")))}function d(t){for(let n=0;n<r;n++)for(let e=0;e<s[n].length;e++)if(s[n][e]===t)return{x:e,y:n}}function x(){for(let t=0;t<r;t++)if(s[~~(t/4)][t%4]!==o[t])return!1;return!0}f(),document.addEventListener("keydown",(function(t){const n=t.key;if(!n.includes("Arrow")||i)return;const e=d(r),{x:o,y:c}=e;let s=o,a=c;switch(n){case"ArrowUp":a++;break;case"ArrowRight":s--;break;case"ArrowDown":a--;break;default:s++}l(s,o,a,c)&&y({x:s,y:a,xTo:o,yTo:c})})),t.addEventListener("click",(function(t){const n=t.target.closest("[data-value]");if(!n||i)return;const e=+n.dataset.value,{x:o,y:c}=d(r),{x:s,y:a}=d(e);l(s,o,a,c)&&y({x:s,y:a,xTo:o,yTo:c})})),t.addEventListener("transitionend",(function(){i&&(n.innerText="Победа!")})),n.addEventListener("click",f)}();